```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

rm(list = ls())

library(disco)

```

# Test disco optimization tools

Read the data for the test.

```{r}

inputSignal <- readRDS(file = "./01_input/inputSignal.RData")
outputSignal <- readRDS(file = "./01_input/outputSignal.RData")

```



```{r}

if (file.exists("./03_incremental")) {
  unlink(
    x = "./03_incremental",
    recursive = TRUE
  )
}

dir.create(
  path = "./03_incremental", 
  showWarnings = FALSE,
  recursive = TRUE
)

# dw <- DielWindowedSignal$new(
#   signal = outputSignal,
#   path = "./03_incremental/signal",
#   dateStart = "2022-07-13",
#   dateEnd = "2022-07-23",
#   windowStart = "00:00:00",
#   windowEnd = "00:00:00",
#   windowDays = 1,
#   "America/Denver"
# )
# 
# dw$createWindows(
#   outerDir = "",
#   minimumRecords = 10
# )

# dw$createWindows(
#   outerDir = "",
#   validFunction = function(signal) {
#     return (signal$getLength() > 10)
#   }
# )

```



```{r}

dw <- DielWindowedTransferFunction$new(
  signalIn = inputSignal,
  signalOut = outputSignal,
  path = "./03_incremental/tf",
  dateStart = "2022-07-13",
  dateEnd = "2022-07-23",
  windowStart = "00:00:00",
  windowEnd = "00:00:00",
  windowDays = 1,
  "America/Denver"
)

dw$createWindowsOffset(
  offsetTime = 3600,
  headersIn = "var",
  outerDir = "",
  validFunction = function(signalOut, signalIn) {
    signalOut$getLength() > 10
  }
)

```
